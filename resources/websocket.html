<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <title>chatter</title>
</head>
<style>
body {
   text-align: center;
   font-family: monospace;
}
</style>
<body>
   <a href ="/"><input value = "INDEX" type="button"></a>
   <h2>WebSocket</h2>
    <p>
       <input  id="name_input" type="TEXT" placeholder="your name"></input>
       <button id="name">ok</button>
    </p>
    <textarea id = "message_field" cols="60" rows="6"></textarea>
    <p><button id="send_button">SEND</button></p>
    <div id="output"></div>
  </body>
  <script>
    const button = document.querySelector("#send_button");
    const output = document.querySelector("#output");
    const textarea = document.querySelector("#message_field");
    const namearea = document.querySelector("#name_input");
    const namebutton = document.querySelector("#name");
    const wsUri = "ws://localhost:8080/";
    const websocket = new WebSocket(wsUri);

    button.addEventListener("click", onClickButton);
    namebutton.addEventListener("click", onNameButton);

    websocket.onopen = (e) => {
       writeToScreen("<span class='log'>CONNECTED</span>");
    };

    websocket.onclose = (e) => {
       writeToScreen("<span class='log'>DISCONNECTED</span>");
    };

    websocket.onmessage = (e) => {
       console.log("NEW MESSAGE");
       const i = e.data.indexOf('|');
       const [name, text] = [e.data.slice(0,i), e.data.slice(i+1)];
       writeToScreen(`<span style="color:red">${name}: </span>${text}`);
    };

    websocket.onerror = (e) => {
      writeToScreen(`<span class="log">ERROR:</span> ${e.data}`);
    };

    function doSend(message) {
      websocket.send(message);
    }

    function writeToScreen(message) {
       output.insertAdjacentHTML("afterbegin", `<p>${message}</p>`);
    }

    function onNameButton() {
       const name = namearea.value;
       name && doSend(`NAME: ${name}`);
       textarea.focus();

    }
    function onClickButton() {
      const text = textarea.value;

      text && doSend(`TEXT: ${text}`);
      textarea.value = "";
      textarea.focus();
    }
  </script>
</body>
</html>

